Metadata-Version: 2.4
Name: csg-v4
Version: 0.1.0
Summary: Continuity–Strain Gravity Version 4 analysis toolkit
Author: Cascade AI
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: numpy>=1.25
Requires-Dist: matplotlib>=3.8
Requires-Dist: tabulate>=0.9
Requires-Dist: pandas>=2.0
Requires-Dist: tqdm>=4.65
Provides-Extra: dev
Requires-Dist: pytest>=7.4; extra == "dev"
Requires-Dist: black>=23.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"
Requires-Dist: isort>=5.12; extra == "dev"
Requires-Dist: mypy>=1.7; extra == "dev"
Requires-Dist: pre-commit>=3.5; extra == "dev"

# CSG V4: Continuity-Strain Gravity Version 4

[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)

**CSG V4** is a research codebase for predicting galaxy rotation curves using a novel salience-based gravitational framework. Instead of invoking dark matter, CSG proposes that gravitational response depends on the "salience" of baryonic structure—a composite measure of continuity, coherence, mass density, and morphology.

## Overview

The central hypothesis: **regions with higher salience exhibit modified gravitational behavior**, interpolating smoothly between Newtonian gravity (high acceleration) and a MOND-like regime (low acceleration). This naturally produces flat rotation curves matching observations without requiring dark matter.

### Key Features

- **Salience-based gravity**: Computes S' (salience) from galaxy properties → transforms to Q (quality factor) → modulates interpolating function
- **MOND-like interpolation**: Smooth transition between g_bar (Newtonian) and √(a_eff * g_bar) (deep MOND)
- **Morphology-aware**: Different galaxy types (grand design spirals, dwarfs, irregulars) receive customized scoring
- **Kappa optimization**: Fits global calibration constant κ_c across multiple galaxies
- **Bootstrap uncertainty**: Statistical confidence intervals via resampling
- **SPARC data support**: Direct ingestion of SPARC (Lelli+2016) galaxy database

## Installation

### Requirements

- Python 3.10 or higher
- NumPy, Matplotlib, Pandas, Tabulate, tqdm

### Quick Setup

```bash
# Clone or navigate to the SAL directory
cd /path/to/SAL

# Install in development mode
pip install -e .

# Or install with dev dependencies for testing
pip install -e ".[dev]"
```

## Quick Start

### Running the Synthetic Pipeline

The easiest way to get started is with the built-in synthetic galaxies:

```bash
# Run from the SAL directory
python -m csg_v4

# Or specify custom output directory
python -m csg_v4 --output-dir my_results
```

This will:
1. Load 3 synthetic galaxies (NGC6503-like, DDO154-like, NGC2403-like)
2. Scan κ_c parameter space to find optimal fit
3. Generate rotation curve plots, kappa scan plots, and residual surfaces
4. Output metrics table and analysis summary

### Using the Python API

```python
from csg_v4 import CSGV4Model, CSGConfig, GalaxyData
import numpy as np

# Create a model with default configuration
model = CSGV4Model()

# Define a simple galaxy
galaxy = GalaxyData(
    name="MyGalaxy",
    galaxy_type="hsb_spiral",
    radii_kpc=np.linspace(1, 15, 20),
    v_obs=np.array([50, 80, 110, 130, ...]),  # Observed velocities
    v_bar=np.array([40, 70, 95, 110, ...]),    # Baryonic velocities
    sigma_v=np.full(20, 10.0),                  # Velocity dispersion
    gas_fraction=0.3,
    age_gyr=10.0,
    has_coherent_rotation=True
)

# Compute salience profile
salience = model.compute_salience(galaxy)
print(f"Mean Q_local: {np.mean(salience['Q_local']):.3f}")

# Predict rotation curve with a trial κ_c
outputs = model.predict_velocity(galaxy, kappa_c=0.5)
print(f"RMS error: {np.sqrt(np.mean((outputs.v_pred - galaxy.v_obs)**2)):.2f} km/s")
```

### Optimizing κ_c for Multiple Galaxies

```python
from csg_v4 import scan_kappa, CSGV4Model
from csg_v4.synthetic_data import load_synthetic_galaxies

# Load test galaxies
galaxies = load_synthetic_galaxies()

# Scan for optimal κ_c
model = CSGV4Model()
scan_result, residual_map = scan_kappa(galaxies.values(), model=model)

print(f"Best κ_c: {scan_result.best_kappa:.4f}")
print(f"Best χ²: {scan_result.best_chisq:.6e}")
```

## Project Structure

```
SAL/
├── src/csg_v4/          # Core CSG V4 package
│   ├── model.py         # Main salience computation & velocity prediction
│   ├── scores.py        # Individual scoring functions (C, R, K, M, etc.)
│   ├── galaxy.py        # GalaxyData dataclass
│   ├── config.py        # CSGConfig with all parameters
│   ├── optimizer.py     # κ_c scanning, refinement, bootstrap
│   ├── analysis.py      # Full pipeline orchestration
│   ├── data_io.py       # SPARC data parsing
│   ├── reporting.py     # Metrics and tabulation
│   └── synthetic_data.py # Test galaxies
├── scripts/             # Experimental scripts (time dilation, mass sweeps, etc.)
├── demos/               # Demonstration notebooks and examples
├── data/sparc/          # SPARC database (if available)
├── artifacts/           # Generated plots and metrics (DO NOT MODIFY)
├── pyproject.toml       # Package metadata
├── README.md            # This file
└── AGENTS.md            # Experimental plan and notes
```

## Core Concepts

### Salience Formula

The heart of CSG V4 is the salience computation:

```
S' = CORE × HYPE × PENALTY
```

Where:
- **CORE** = C_local × R_galaxy × K_galaxy × M_local
  (continuity × retention × coherence × mass)
- **HYPE** = 1 + (boost terms) - (penalty terms)
  (morphology-dependent amplification)
- **PENALTY** = 1 - β_phi × phi_galaxy - β_J × J_galaxy
  (structural disorder reduction)

Then S' is transformed to a quality factor:
```
Q_local = S'^0.25  (fourth-root scaling)
Q_final = (1-α)*Q_local + α*A_galaxy  (blend local + global)
```

### Interpolating Function

The predicted acceleration interpolates between Newtonian and MOND regimes:

```
a_eff = κ_c * (a0 / Q_final)
x = g_bar / a_eff
μ = x / (1 + x)
g_obs = μ * g_bar + (1-μ) * √(a_eff * g_bar)
```

- When g_bar >> a_eff (inner regions): μ → 1, g_obs → g_bar (Newtonian)
- When g_bar << a_eff (outer regions): μ → 0, g_obs → √(a_eff * g_bar) (MOND)

Higher salience (lower Q) → lower a_eff → more MOND-like behavior

### Scoring Components

| Score | Meaning | Range |
|-------|---------|-------|
| C_local | Local continuity (v/σ ratio) | [0, 1] |
| R_galaxy | Retention (age + kinematics) | [0, 1] |
| K_galaxy | Coherence fraction (% ordered) | [0, 1] |
| M_local | Mass density score | [0, 1] |
| W_local | Curvature irregularity | [0, 1] |
| phi_galaxy | Disorder penalty | [0, 1] |
| J_galaxy | Coherence gap | [0, 1] |
| X_galaxy | Edge case boost | {0, 1} |
| S_h_galaxy | Stress-history | [0, 1] |
| DeltaA_local | Morphology boost | [0, 1] |

For detailed mathematical definitions, see [`docs/CONCEPTS.md`](docs/CONCEPTS.md).

## Documentation

- **[docs/CONCEPTS.md](docs/CONCEPTS.md)**: Deep dive into salience theory and formulas
- **[docs/examples/](docs/examples/)**: Usage examples and tutorials
- **[AGENTS.md](AGENTS.md)**: Experimental plan and research notes

## Configuration

All tunable parameters live in `CSGConfig` (see `src/csg_v4/config.py`):

**Physical Constants:**
- `G = 4.302e-6`: Gravitational constant [kpc³/M_sun/Gyr²]
- `c = 299792.458`: Speed of light [km/s]
- `H0 = 70.0`: Hubble constant [km/s/Mpc]
- `V0 = 50.0`: Reference velocity [km/s]

**Salience Weights:**
- `alpha_n = 0.35`: DeltaA contribution to HYPE
- `gamma_X = 0.25`: Edge case boost
- `gamma_Sh = 0.30`: Stress-history boost
- `gamma_W = 0.55`: Curvature penalty
- `gamma_workhorse = 0.35`: Workhorse galaxy bonus
- `beta_phi = 0.60`: Disorder penalty weight
- `beta_J = 0.45`: Coherence gap penalty weight

**Quality Factor:**
- `aura_mix = 0.5`: Blend weight for global vs. local Q
- `min_s_prime = 1e-10`: Numerical floor for S'
- `min_q_final = 1e-6`: Numerical floor for Q_final

You can override defaults:

```python
from csg_v4 import CSGConfig, CSGV4Model

# Custom configuration
config = CSGConfig(
    alpha_n=0.40,        # Boost morphology contribution
    gamma_W=0.60,        # Stronger curvature penalty
    aura_mix=0.6,        # More global influence
)

model = CSGV4Model(config)
```

## Advanced Usage

### Loading SPARC Galaxies

If you have SPARC data tables (Lelli+2016):

```python
from csg_v4.data_io import SPARCParser
from csg_v4 import CSGConfig
from pathlib import Path

# Initialize parser
parser = SPARCParser(
    table1_path=Path("data/sparc/table1.dat"),
    table2_path=Path("data/sparc/table2.dat"),
    rotmod_dir=Path("data/sparc/extended/extracted/rotmod")  # Optional
)

# List available galaxies
galaxies = parser.list_galaxies()
print(f"Found {len(galaxies)} galaxies")

# Load specific galaxies
config = CSGConfig()
galaxy_data = parser.load_galaxies(
    selection=["NGC6503", "DDO154", "NGC2403"],
    config=config,
    stellar_ml=0.5  # Stellar mass-to-light ratio
)
```

### Refinement and Uncertainty

```python
from csg_v4.optimizer import refine_kappa, bootstrap_kappa

# Initial scan
scan_result, _ = scan_kappa(galaxies, model=model, store_profiles=True)

# Refine with quadratic fit and golden section search
refinement = refine_kappa(galaxies, model, scan_result)
print(f"Quadratic κ_c: {refinement.quadratic.kappa:.6f} ± {refinement.quadratic.sigma:.6f}")
print(f"Golden-section κ_c: {refinement.golden.kappa:.6f}")

# Bootstrap uncertainty
bootstrap_estimates = bootstrap_kappa(scan_result, config)
print(f"Bootstrap mean: {np.mean(bootstrap_estimates):.6f}")
print(f"Bootstrap std: {np.std(bootstrap_estimates):.6f}")
```

## Experimental Scripts

The `scripts/` directory contains research code for testing salience-related hypotheses:

- `continuity_mass_sim.py`: Continuity-taxed controller mass sweep
- `time_dilation_train.py`: Time dilation under continuity strain
- `unified_inertia_time_probe.py`: Adaptive inertia experiments
- `coherence_scanner.py`: Coherence landscape exploration
- `quantum_salience_3qubit.py`: Quantum circuit salience probes

See [`AGENTS.md`](AGENTS.md) for experimental protocols and interpretation.

## Contributing

This is research code under active development. Key principles:

- **DO NOT modify `artifacts/`**: Generated outputs are preserved for reproducibility
- **Keep logic unchanged**: This codebase implements a specific research hypothesis
- **Enhance documentation**: Clear explanations help scientific review
- **Add tests**: Validate behavior without changing algorithms

## Citation

If you use this code in research, please cite:

```
CSG V4: Continuity-Strain Gravity Version 4
https://github.com/[your-org]/SAL-X
```

## License

[Specify your license here]

## References

- Lelli et al. 2016, "SPARC: Mass Models for 175 Disk Galaxies", AJ, 152, 157
- Milgrom 1983, "A modification of the Newtonian dynamics", ApJ, 270, 365
- [Add relevant CSG/salience theory papers]

## Support

For questions or issues:
- Open an issue on GitHub
- Review existing experiments in `AGENTS.md`
- Check example code in `docs/examples/`

---

**Note:** This is research code. Results should be interpreted carefully and validated against observational data.
